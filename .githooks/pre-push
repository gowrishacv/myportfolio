#!/usr/bin/env bash
set -euo pipefail

# Block direct pushes to main and show a friendly custom message.
# Git provides lines on stdin: <local ref> <local sha> <remote ref> <remote sha>
# We reject if any update targets refs/heads/main.

blocked=0
while read -r local_ref local_sha remote_ref remote_sha; do
  if [[ "$remote_ref" == "refs/heads/main" ]]; then
    blocked=1
  fi
done

if [[ "$blocked" == "1" ]]; then
  cat <<'MSG'

Direct push to 'main' is blocked.

Please push to the 'pre' branch and open a Pull Request from 'pre' -> 'main'.
If you don't have access, please talk to Gowrish.

Tip:
  git push origin pre

MSG
  exit 1
fi

exit 0
